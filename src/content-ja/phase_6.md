## Phase 6: SKILL.md への蒸留

**目的**: 全調査結果を500行以下の実用的なスキルに凝縮する

### Step 1: 「Claudeは既に知っているか？」フィルタ

蒸留の前に、全調査結果を以下のフィルタにかける：

| 問い | 結果 |
|------|------|
| Claudeは既にこれを知っているか？ | → **削除**（一般知識） |
| Claudeのデフォルト行動を変えたいか？ | → **残す**（ルール・制約） |
| プロジェクト/ドメイン固有の情報か？ | → **残す**（固有知識） |
| 具体的なコード例やツール名を含むか？ | → **残す**（実装の手がかり） |

例:
- ❌「レスポンシブデザインとは画面サイズに合わせたデザイン」→ Claudeは知っている
- ✅「ブレイクポイントはpxでなくremで指定する」→ デフォルト行動を変える
- ✅「このプロジェクトではTailwindを使い、カスタムCSSは禁止」→ 固有ルール

### Step 2: スキルの設計判断

SKILL.md を書く前に、以下を決定する：

| 判断項目 | 選択肢 | 判断基準 |
|---------|--------|---------|
| スキルの種類 | Reference / Task | 知識追加か、手順実行か |
| 自由度 | 高 / 中 / 低 | 失敗リスクの大きさ、正解の幅 |
| 呼び出し方式 | 自動 / ユーザー専用 / 両方 | 頻度、影響範囲 |
| スクリプトの要否 | あり / なし | 検証・自動化の必要性 |
| テンプレートの要否 | あり / なし | 出力フォーマットの厳密さ |
| 参照ファイルの構成 | フラット / ドメイン別 / 条件分岐別 | 情報量と分類軸 |
| ポータビリティ | 標準のみ / Claude Code固有も使う | 対象エージェントの範囲 |

**ポータビリティのトレードオフ**:
- **標準のみ** (agentskills.io 仕様): VS Code Copilot, Claude Code, Cursor, Goose, Amp 等で動作
- **Claude Code 固有も使う** (`context: fork`, `` !`cmd` ``, `$ARGUMENTS` 等): 機能は強力だが他ツールでは動作しない

→ 個人スキルなら固有機能OK、チーム/公開スキルなら標準に留める。

### Step 3: 蒸留と記述

| ステップ | やること |
|---------|---------|
| 3a | フィルタ済み情報を指示・ルール・チェックリスト形式に変換 |
| 3b | YAML frontmatter を設定（name, description, 呼び出し制御等） |
| 3c | 本文を Progressive Disclosure に従い構造化 |
| 3d | 500行 / ~5000トークン以内に収める |

### 蒸留の優先順位

情報量 > 500行の場合、以下の優先順で残す：

1. **ルール・禁止事項** — 「これを破ると品質が落ちる」もの
2. **チェックリスト** — 実装後に毎回確認すべきもの
3. **判断基準・意思決定フロー** — 選択に迷ったときの指針
4. **パターンと使い分け** — 代表的な実装パターン
5. **理論・原則の要約** — 判断の裏付け（最小限）
6. **具体例** — スペースが許す範囲で

### 記述パターン集

蒸留したコンテンツには、目的に応じた記述パターンを使う：

| パターン | 用途 | 例 |
|---------|------|-----|
| **テンプレートパターン** | 出力形式が厳格 | `ALWAYS use this exact template:` |
| **Examplesパターン** | 入出力ペアでスタイルを示す | 良い例/悪い例の対比 |
| **条件分岐パターン** | 状況による対応の分岐 | `Creating? → A workflow / Editing? → B workflow` |
| **フィードバックループ** | 品質が重要な反復作業 | `実行→検証→修正→再検証` |
| **デフォルト+例外パターン** | 選択肢を絞り効率化 | デフォルトを1つ提示、例外ケースのみ代替記述 |
| **plan-validate-execute** | バッチ操作・破壊的変更 | 計画ファイル作成 → スクリプトで検証 → 実行 |

### コンテンツ記述ガイドライン

- **時間依存情報を避ける**: 「2025年8月以前は旧API」のような記述は使わない。Legacy情報は `<details>` で折りたたむ
- **用語の一貫性**: 同じ概念に複数の用語を使わない（例: "API endpoint" と "URL" と "path" を混在させない）
- **100行以上の参照ファイルには目次を付ける**
- **MCP ツールは完全修飾名で参照**: `BigQuery:bigquery_schema`, `GitHub:create_issue`

### ランタイム環境制約

スクリプトを含むスキルを作る場合、デプロイ先の環境制約を考慮する：

| Surface | ネットワーク | パッケージインストール | 注意点 |
|---------|------------|----------------------|--------|
| **Claude Code** | ✅ フルアクセス | ローカル推奨 | グローバルインストールは避ける |
| **claude.ai** | ⚠️ 設定依存 | npm, PyPI, GitHub から可 | 管理者設定で制限される場合あり |
| **Claude API** | ❌ アクセス不可 | ❌ インストール不可 | プリインストール済みのみ使用可 |

→ 複数 surface 対応のスキルは、最も制約の厳しい環境に合わせて設計する。

### 記述のアンチパターン

| アンチパターン | 対策 |
|--------------|------|
| Windows スタイルパス (`\`) | 常にフォワードスラッシュ (`/`) を使用 |
| 選択肢の提示が多すぎる | デフォルト1つ + 例外ケースのみ記述 |
| Claude に丸投げするエラー処理 | スクリプト内で明示的にエラーハンドリング |
| マジックナンバー | 全ての定数にコメントで理由を記述 |
| ツールのインストール前提 | 依存パッケージの存在確認とリスト |
| 深い参照チェーン | SKILL.md → 参照ファイルは1レベルまで |

---

